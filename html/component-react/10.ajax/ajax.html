<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="../../../js/react.js"></script>
    <script src="../../../js/react.dom.js"></script>
    <script src="https://cdn.bootcss.com/prop-types/15.7.2/prop-types.js"></script>
    <script src="../../../js/babel.min.js"></script>
    <script src="https://cdn.bootcss.com/axios/0.19.0-beta.1/axios.js"></script>
    <script src="https://cdn.bootcss.com/fetch/3.0.0/fetch.js"></script>
    <title>Document</title>
</head>
<body>
<div id="box"></div>
<script type="text/babel">
    /**
     * 1.react没有ajax模块
     *      继承其他的js库（比如jQuery/fetch/axios）,发送ajax请求
     * 2.使用axios
     *      https://github.com/mzabriskie/axios
     * 3.使用fetch
     *      https://github.github.io/fetch/
     *      http://segmentfault.com/a/1190000003810652
     * 4.测试url
     *      https://api.github.com/users/octocat/gists
     *
     *
     */
    class AjaxComponent extends React.Component {
        constructor(props) {
            super(props);
            this.state = {
                gistUrl: null
            }
        }

        componentDidMount() {
            //    发送ajax请求
            let url = "https://api.github.com/users/octocat/gists";
            axios.get(url)
                .then(response => {

                    console.log(response);
                    let data = response.data;
                    //更新状态
                    this.setState({
                        gistUrl: data[0].html_url
                    })
                })
                .catch(error => {
                    console.log(error);
                })

            fetch(url)
                .then(response => {
                    //
                    return response.json();
                })
                .then(data => {      //这里是真正获取数据的回调
                    console.log(data);
                    //更新状态
                    this.setState({
                        gistUrl: data[0].html_url
                    })
                })
                .catch(e => {
                    console.log("Oops, error");
                });
        }

        render() {
            let {gistUrl} = this.state;
            if (!gistUrl) {
                return (
                    <div>
                        <h2>Loading...</h2>
                    </div>
                );
            } else {
                return (
                    <a href={gistUrl}>Click here</a>
                );
            }

        }
    }

    ReactDOM.render(<AjaxComponent/>, document.getElementById('box'));
</script>
</body>
</html>