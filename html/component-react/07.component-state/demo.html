<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="../../../js/react.js"></script>
    <script src="../../../js/react.dom.js"></script>
    <script src="https://cdn.bootcss.com/prop-types/15.7.2/prop-types.js"></script>
    <script src="../../../js/babel.min.js"></script>
    <title>Demo</title>
</head>

<body>
    <div id="box"></div>
    <hr>
    <div id="box2"></div>
    <script type="text/babel">
    /**
     * 1.App
     * 2.AddTodo
     * 3.数据源初始化在哪：App组件
     *
     */
    class A extends React.Component {
        render() {
            return (
                <div>
                    <h1>Simple TODO List</h1>
                    <input type="text"/>
                    <button>ADD #5</button>
                    <ul>
                        <li>CF</li>
                        <li>吃饭</li>
                        <li>睡觉</li>
                        <li>打豆豆</li>
                        <li>学习</li>
                    </ul>
                </div>
            );
        }
    }

    // 定义App组件
    class App extends React.Component {
        constructor(props) {
            super(props);
            //初始化数据
            this.state = {
                todos: ['吃饭', '睡觉', '打豆豆']
            };
            //更改add的this指向
            this.add = this.add.bind(this);
        }

        add(newTodo){
            console.log(newTodo);
            

            //更新状态
            let todos = this.state.todos;
            todos.unshift(newTodo);
            this.setState({todos});
        }
        render() {
            let {todos} = this.state;
            return (
                <div>
                    <h1>Simple TODO List</h1>
                    <AddTodo add={this.add} length={todos.length} />
                    <TodoList todos={todos}/>

                </div>
            );
        }
    }

    // 定义AddTodo组件
    class AddTodo extends React.Component {
        constructor(props) {
            super(props);
            //强制绑定this，在构造函数中this指向实例对象
            this.addTodo = this.addTodo.bind(this);
        }
        addTodo(){
            //收集数据
            let newTodo = this.refs.newTodo.value;
            //先判断是否符合要求
            if(!newTodo.trim()){
                alert("输入的内容不能为空");
                return;
            }
            this.props.add(newTodo);
            //添加成功之后清空输入框
            this.refs.newTodo.value = '';

        }

        render() {
            return (
                <div>
                    <input type="text" ref="newTodo"/>
                    <button onClick={this.addTodo}>ADD #{this.props.length}</button>
                </div>
            );
        }
    }

    //定义TodoList组件
    class TodoList extends React.Component {
        render() {
            //解构赋值
            let {todos} = this.props;
            return (
                <ul>
                    {
                        todos.map((item, index) => {
                            return <li key={index}>{item}</li>
                        })
                    }
                </ul>
            );
        }
    }

    //渲染组件
    ReactDOM.render(<A/>, document.getElementById('box'));
    ReactDOM.render(<App/>, document.getElementById('box2'));
</script>
</body>

</html>